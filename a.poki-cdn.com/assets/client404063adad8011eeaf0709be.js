"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[4040],{24040:(e,t,n)=>{n.r(t),n.d(t,{fetchSaveGameEpic:()=>z,fixIOSFullscreen:()=>X,fullscreenEpic:()=>Q,gameLoadingFinishedEpic:()=>j,generateScreenshotEpic:()=>J,mutateSaveGameEpic:()=>A,pubHostInitializedEpic:()=>M,receiveScreenshotEpic:()=>q,sendBugReportEpic:()=>Z,setRecentGameEpic:()=>K,showCSPWarningEpic:()=>Y,trackRecentGameEpic:()=>W,updatePokiURLParams:()=>H});var o=n(59099),i=n(8767),r=n(63720),a=n(61701),l=n(62467),c=n(65693),s=n(76981),u=n(56978),d=n(44240),p=n(67791),g=n(16126),v=n(81160),f=n(25100),m=n(83349),w=n(29079),y=n(77783),h=n(72641),E=n(48554),_=n(46493),b=n(67662),S=n(29194),k=n(90385),x=n(13150),I=n(4834),D=n(25302),O=n(23260),R=n(58606),G=n(53210),L=n(25733),F=n(6788),P=n(71219),$=n(56469),B=n(74275),C=n(86494);function H(e){return e.pipe((0,w.g)(E.h8.type),(0,o.M)((e=>{const{params:t}=e;if(!t)return;const n=Object.keys(t),o=new URLSearchParams(window.location.search),i=[];o.forEach(((e,t)=>{t.startsWith("gd")&&i.push(t)})),i.forEach((e=>{o.delete(e)})),n.forEach((e=>{o.set(`gd${e}`,t[e])})),window.history.replaceState({},document.title,`${window.location.pathname}?${o.toString()}`)})),(0,i.w)())}function M(e,t){return e.pipe((0,w.g)(E.iG.type),(0,r.n)((e=>{const n=(0,k.Vv)(t.value);return n?((0,_.F)({category:"pubHost",action:"initialized",data:e}),delete e.source,(0,l.of)((0,E.iw)({gameId:n.id,data:e}))):a.w})))}function A(e,t){return e.pipe((0,w.g)(E.Gs.type),(0,o.M)((async({action:e,key:n,value:o})=>{const i=(0,k.Vv)(t.value);if(i)try{const t=(0,y.y$)(`savegame:${i.id}`,"ls");"clear"===e?await(0,y.IU)(t):"delete"===e?await(0,y.yH)(n,t):"set"===e&&await(0,y.hZ)(n,o,t)}catch(e){console.error(e)}})),(0,i.w)())}function z(e,t){return e.pipe((0,w.g)(E.on.type),(0,o.M)((async()=>{const e=(0,k.Vv)(t.value);if(e)try{var n,o;const t=(0,y.y$)(`savegame:${e.id}`,"ls"),i=(await(0,y.jO)(t)).reduce(((e,[t,n])=>(e[t]=n,e)),{});null===(n=window.frames)||void 0===n||null===(n=n.gameFrame)||void 0===n||null===(o=n.postMessage)||void 0===o||o.call(n,{type:"fetchedSaveGame",data:i},"*")}catch(e){console.error(e)}})),(0,i.w)())}const N=()=>document.getElementById("game-container"),T=()=>document.getElementById("game-element"),V=()=>{T()&&(0,$.e)()};function X(e,t){if(!(0,b.H6)(t.value)||"undefined"==typeof window)return a.w;const n=(0,c.R)(window,"resize").pipe((0,s.c)(500),(0,r.n)((()=>(V(),a.w))),(0,u.B)(3e3)),o=(0,c.R)(window,"orientationchange").pipe((0,r.n)((()=>(V(),a.w))),(0,u.B)(3e3));return e.pipe((0,w.g)(E.gO.type),(0,r.n)((({toggle:t})=>t?((0,I.r)(),V(),(0,d.h)(n,o).pipe((0,p.Q)(e.pipe((0,w.g)(E.gO.type),(0,g.p)((({toggle:e})=>!e)))))):a.w)))}const U=(e,t)=>{var n,o;if(!e)return;const i=(0,b.zS)(t),r=(0,b.W3)(t),a=(0,k.Vv)(t),l=(0,b.H6)(t),c=null===(n=window)||void 0===n||null===(n=n.screen)||void 0===n||null===(n=n.orientation)||void 0===n?void 0:n.lock,s=l&&c&&(null==a||null===(o=a.mobile_file)||void 0===o?void 0:o.orientation);if(!i&&!r)try{e.requestFullscreen({navigationUI:"hide"}).catch((()=>{}))}catch{}finally{e.focus()}var u;s&&(u=a.mobile_file.orientation,["portrait","landscape"].includes(u)&&window.screen.orientation.lock(u).catch((()=>{})))};function K(e,t){if("undefined"==typeof window)return a.w;const n=(0,S.Gd)(t.value);return e.pipe((0,w.g)(h.Xy.type,O.y.type),(0,g.p)((()=>{const e="game"===(0,k.K5)(t.value),n=(0,k.U0)(t.value);return e&&200===n})),(0,v.T)((()=>{const e=(0,k.Vv)(t.value),{id:o}=e||{};if(!o)return a.w;const i=[...(0,b.Fe)(t.value)],r=i.findIndex((e=>e.id===o)),l=r>-1?i.filter((e=>e.id!==o)):i,c={id:o,pt:r>-1?i[r].pt:0,lp:Date.now()};l.unshift(c);const s=l.slice(0,100);return(0,h.pX)({recentGames:s,siteID:n.id})})))}function W(e,t){if("undefined"==typeof window)return a.w;const n=(0,S.Gd)(t.value),o=e.pipe((0,w.g)(O.y.type));return e.pipe((0,w.g)(h.pX.type),(0,r.n)((()=>(0,f.O)(6e4).pipe((0,v.T)((()=>{const{id:e}=(0,k.Vv)(t.value),o=(0,b.Fe)(t.value),i=o.find((t=>t.id===e));if(i){const t=parseInt(i.pt||0,10)+60,r=o.map((n=>n.id===e?{...n,pt:t}:n));return(0,h.pX)({recentGames:r,siteID:n.id})}return a.w})),(0,p.Q)(o)))))}function Q(e,t){const n=(0,c.R)(window,"fullscreenchange").pipe((0,r.n)((()=>{var e,n,o;return V(),(0,E.QX)(t.value)!==!(null===(e=document)||void 0===e||!e.fullscreenElement)&&(!(0,b.H6)(t.value)||null!==(n=document)&&void 0!==n&&n.fullscreenElement)?(0,l.of)((0,E.gO)({toggle:!(null===(o=document)||void 0===o||!o.fullscreenElement)})):a.w}))),s=e.pipe((0,w.g)(E.lh.type),(0,g.p)((({toggle:e})=>e)),(0,o.M)((()=>{U(document.body,t.value)})),(0,v.T)((()=>(0,E.gO)({toggle:!0})))),u=()=>{var e,n;if(!(0,E.QX)(t.value))return a.w;null===(e=window)||void 0===e||null===(e=e.PokiSDK)||void 0===e||null===(n=e.stopVideoAd)||void 0===n||n.call(e),(0,D.Jb)();try{var o,i;null===(o=document)||void 0===o||null===(i=o.exitFullscreen)||void 0===i||i.call(o).catch((()=>{}))}catch{}return window.removeEventListener("resize",V),window.removeEventListener("orientationchange",V),(0,l.of)((0,E.gO)({toggle:!1}))},f=e.pipe((0,w.g)(E.lh.type),(0,g.p)((({toggle:e})=>!e)),(0,r.n)((()=>u()))),m=e.pipe((0,w.g)("@@router/LOCATION_CHANGE"),(0,g.p)((()=>!window.location.toString().includes("#fullscreen")&&!window.location.toString().includes("#goog_rewarded"))),(0,r.n)((()=>u()))),y=e.pipe((0,w.g)(E.Br.type),(0,g.p)((()=>(0,b.H6)(t.value))),(0,r.n)((()=>(0,d.h)((0,c.R)(N(),"click"),(0,c.R)(T(),"click")).pipe((0,g.p)((()=>(0,b.H6)(t.value))),(0,o.M)((()=>{U(document.body,t.value),(0,D.IF)()})),(0,p.Q)(f),(0,i.w)())))),h=e.pipe((0,w.g)(E.gO.type),(0,r.n)((({payload:e})=>{const{toggle:t}=e,{body:n}=document,o=document.getElementById("app-root");return o.style.overflow=t?"hidden":"auto",o.style.height=t?"100dvh":"auto",t?n.classList.add("isFullscreen"):n.classList.remove("isFullscreen"),a.w})));return(0,d.h)(s,f,m,n,y,h)}function j(e){return e.pipe((0,w.g)(E.wZ.type),(0,g.p)((({event:e})=>e===x.NS)),(0,v.T)((()=>(0,E.x9)())))}function J(e,t){return e.pipe((0,w.g)(E.kK.type),(0,m.c)(3e3),(0,g.p)((()=>{var e;return null===(e=window)||void 0===e||null===(e=e.frames)||void 0===e?void 0:e.gameFrame})),(0,o.M)((({callback:e})=>{var n;const o="screenshot"===e,i=(0,k.Vv)(t.value);window.frames.gameFrame.postMessage({type:"pokiGenerateScreenshot",hasFrame:o,title:i.title,thumbnail:null===(n=i.image)||void 0===n?void 0:n.path,callback:e},"*")})))}function Z(e,t){return e.pipe((0,w.g)(F.X$.type),(0,m.c)(1e4),(0,r.n)((({screenshot:e,errors:n})=>{var o;const r=(0,F.p3)(t.value),a=e?`${r}\n\n${e}`:r,l=(0,R.A)("tracking"),c=(0,G.p)(t.value),s=(0,E.yd)(t.value),u=(0,S.Gd)(t.value),d=(0,k.Vv)(t.value),p=(0,P.nj)(t.value),g=(0,E.zM)(t.value),v=(0,E.pT)(t.value),f=(0,L.v)(t.value),m=(null==s?void 0:s.gameID)===d.pokifordevs_game_id?s.gameVersion:void 0,w=(null==f||null===(o=f.page)||void 0===o?void 0:o.start)>0?Date.now()-f.page.start:0,y=document.getElementById("game-element");let h,_;y&&(h=`${y.clientWidth}x${y.clientHeight}`);try{const e=document.createElement("canvas"),t={powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1};let n=e.getContext("webgl2",t);if(n||(n=e.getContext("webgl",t),n||(n=e.getContext("experimental-webgl",t))),n){const e=n.getExtension("WEBGL_debug_renderer_info");e&&(_=n.getParameter(e.UNMASKED_RENDERER_WEBGL)),_||(_=n.getParameter(n.RENDERER))}}catch{}return l("/playground-feedback",{method:"POST",body:JSON.stringify({p4d_game_id:d.pokifordevs_game_id,p4d_version_id:m,type:"bugreport",site_id:u.id,message:a,experiment:c,adblock:p,was_fullscreen:g,game_resolution:h,loading_finished:v,time_on_page:w,errors:n,webgl_renderer:_,device_pixel_ratio:window.devicePixelRatio||1})}).pipe((0,i.w)())})))}function q(e,t){return e.pipe((0,w.g)(E.u9.type),(0,v.T)((e=>null==e?void 0:e.data)),(0,r.n)((({screenshot:e,errors:n,callback:o})=>{if("bugReport"===o)try{return(0,l.of)((0,F.X$)({screenshot:e,errors:n}))}catch{return a.w}if("ratings"===o)try{const o=(0,B.xI)(t.value);return(0,l.of)((0,C.rY)({voteDirection:o.voteDirection,message:o.message,screenshot:e,errors:n}))}catch{return a.w}})))}function Y(e,t){return e.pipe((0,w.g)(h.Xy.type),(0,g.p)((()=>"preview"===(0,k.K5)(t.value))),(0,s.c)(1e4),(0,o.M)((()=>{console.info("%c🛡️ Content Security Policy (CSP) Notice 🛡️\n\n%cThis website has a strict Content Security Policy.\nIf your game needs to access external resources, please contact us.\n\n%c📧 Email your exact domains, including ports and protocol, to: developers@poki.com\n🔗 Don't forget to include a link to your game!\n\n%cThank you for your cooperation in maintaining our security standards!","font-size: 20px; font-weight: bold; color: #4a90e2;","font-size: 14px; color: #666;","font-size: 14px; color: #0a84ff; font-weight: bold;","font-size: 14px; color: #666; font-style: italic;")})),(0,i.w)())}}}]);